import * as d3 from 'd3'; 
(()=>{var t={149:()=>{}},e={};function a(r){var n=e[r];if(void 0!==n)return n.exports;var d=e[r]={exports:{}};return t[r](d,d.exports,a),d.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};a.r(t),a.d(t,{AddRelative:()=>T,addNewPerson:()=>_,addNewPersonAndHandleRels:()=>y,cardChangeMain:()=>F,cardEdit:()=>z,cardShowHideRels:()=>A,checkIfRelativesConnectedWithoutPerson:()=>i,createNewPerson:()=>p,createNewPersonWithGenderFromRel:()=>f,createTreeDataWithMainNode:()=>g,deletePerson:()=>l,generateUUID:()=>h,handleRelsOfNewDatum:()=>m,isAllRelativeDisplayed:()=>u,manualZoom:()=>o,moveToAddToAdded:()=>c,removeToAdd:()=>s});var e={};a.r(e),a.d(e,{Card:()=>I,CardBody:()=>x,CardBodyAddNew:()=>$,CardBodyOutline:()=>w,CardImage:()=>P,HideIcon:()=>b,LinkBreakIcon:()=>E,LinkBreakIconWrapper:()=>L,MiniTree:()=>k,PencilIcon:()=>v,PlusIcon:()=>M});const r="object"==typeof window&&window.d3?window.d3:_d3;function n(t,e){const a=e?"rels":"_rels",r=e?"_rels":"rels";function n(e){t.data[a]&&t.data[a][e]&&(t.data[r]||(t.data[r]={}),t.data[r][e]=t.data[a][e],delete t.data[a][e])}t.is_ancestry||t.data.main?(n("father"),n("mother")):function(){if(!t.data[a]||!t.data[a].children)return;const e=t.data[a].children.slice(0),n=t.spouse?[t.spouse]:t.spouses||[];[t,...n].forEach((t=>e.forEach((e=>{t.data[a].children.includes(e)&&(t.data[r]||(t.data[r]={}),t.data[r].children||(t.data[r].children=[]),t.data[r].children.push(e),t.data[a].children.splice(t.data[a].children.indexOf(e),1))}))))}()}function d(t,e){t.forEach((t=>{t.data.hide_rels=e,n(t,e)}))}function i(t,e){const a=t.rels,r=[a.father,a.mother,...a.spouses||[],...a.children||[]].filter((t=>!!t)),n=[];for(let a=0;a<r.length;a++)if(!d(e.find((t=>t.id===r[a])),[t])){n.push(r[a]);break}return 0===n.length;function d(t,a){let r;return i(t)&&(r=[t]),function t(n,d){function c(t){const e=n.rels;[e.father,e.mother,...e.spouses||[],...e.children||[]].filter((t=>t&&![...a,...d].find((e=>e.id===t)))).forEach((e=>t(e)))}r||(d=[...d,n],c((function(t){i(t)&&(r=d)})),r||c((function(a){const r=e.find((t=>t.id===a));t(r,d)})))}(t,[t]),r}function i(t){return"object"==typeof t?t.id===e[0].id:t===e[0].id}}function c(t,e){return delete t.to_add,t}function s(t,e){return l(t,e),!1}function l(t,e){return i(t,e)?(e.forEach((e=>{for(let a in e.rels)e.rels.hasOwnProperty(a)&&(e.rels[a]===t.id?delete e.rels[a]:Array.isArray(e.rels[a])&&e.rels[a].includes(t.id)&&e.rels[a].splice(e.rels[a].findIndex((e=>e===t.id)),1))})),e.splice(e.findIndex((e=>e.id===t.id)),1),e.forEach((t=>{t.to_add&&l(t,e)})),0===e.length&&e.push(g({}).data[0]),{success:!0}):{success:!1,error:"checkIfRelativesConnectedWithoutPerson"}}function o({amount:t,svg:e,transition_time:a=500}){const n=e.__zoomObj;r.select(e).transition().duration(a||0).delay(a?100:0).call(n.scaleBy,t)}function u(t,e){const a=t.data.rels;return[a.father,a.mother,...a.spouses||[],...a.children||[]].filter((t=>t)).every((t=>e.some((e=>e.data.id===t))))}function h(){var t=(new Date).getTime(),e=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(a){var r=16*Math.random();return t>0?(r=(t+r)%16|0,t=Math.floor(t/16)):(r=(e+r)%16|0,e=Math.floor(e/16)),("x"===a?r:3&r|8).toString(16)}))}function m({datum:t,data_stash:e,rel_type:a,rel_datum:r}){function n(t){r.rels.spouses&&r.rels.spouses.forEach((t=>{const a=e.find((e=>e.id===t));a.to_add&&s(a,e)})),r.rels.spouses||(r.rels.spouses=[]),r.rels.spouses.push(t.id),t.rels.spouses=[r.id]}"daughter"===a||"son"===a?function(t){t.data.other_parent&&(function(a){"_new"===a&&(a=function(){const t=f({rel_type:"spouse",rel_datum:r});return n(t),_({data_stash:e,datum:t}),t}().id);const d=e.find((t=>t.id===a));t.rels["M"===d.data.gender?"father":"mother"]=d.id,d.rels.hasOwnProperty("children")||(d.rels.children=[]),d.rels.children.push(t.id)}(t.data.other_parent),delete t.data.other_parent),t.rels["M"===r.data.gender?"father":"mother"]=r.id,r.rels.children||(r.rels.children=[]),r.rels.children.push(t.id)}(t):"father"===a||"mother"===a?function(t){const a="M"===t.data.gender,n=r.rels[a?"father":"mother"];n&&s(e.find((t=>t.id===n)),e),r.rels[a?"father":"mother"]=t.id,function(){const n=r.rels[a?"mother":"father"];if(!n)return;const d=e.find((t=>t.id===n));t.rels.spouses=[n],d.rels.spouses||(d.rels.spouses=[]),d.rels.spouses.push(t.id)}(),t.rels.children=[r.id]}(t):"spouse"===a&&n(t)}function p({data:t,rels:e}){return{id:h(),data:t||{},rels:e||{}}}function f({data:t,rel_type:e,rel_datum:a}){const r=function(t,e){return["daughter","mother"].includes(e)||"spouse"===e&&"M"===t.data.gender?"F":"M"}(a,e);return p({data:t=Object.assign(t||{},{gender:r})})}function _({data_stash:t,datum:e}){t.push(e)}function g({data:t,version:e}){return{data:[p({data:t})],version:e}}function y({datum:t,data_stash:e,rel_type:a,rel_datum:r}){_({data_stash:e,datum:t}),m({datum:t,data_stash:e,rel_type:a,rel_datum:r})}function x({d:t,card_dim:e,card_display:a}){return{template:`\n      <g class="card-body">\n        <rect width="${e.w}" height="${e.h}" class="card-body-rect" />\n        <g transform="translate(${e.text_x}, ${e.text_y})">\n          <text clip-path="url(#card_text_clip)">\n            <tspan x="0" dy="14">${a[0](t.data)}</tspan>\n            <tspan x="0" dy="14" font-size="10">${a[1](t.data)}</tspan>\n          </text>\n          <rect width="${e.w-e.text_x-10}" height="${e.h-20}" style="mask: url(#fade)" class="text-overflow-mask" /> \n        </g>\n      </g>\n    `}}function $({d:t,card_dim:e,card_add:a,label:r}){return{template:`\n      <g class="card-body ${a?"card_add":"card-unknown"}">\n        <rect class="card-body-rect" width="${e.w}" height="${e.h}" fill="rgb(59, 85, 96)" />\n        <text transform="translate(${e.w/2}, ${e.h/2})" text-anchor="middle" fill="#fff">\n          <tspan font-size="18" dy="8">${r}</tspan>\n        </text>\n      </g>\n    `}}function w({d:t,card_dim:e,is_new:a}){return{template:`\n      <rect width="${e.w}" height="${e.h}" rx="4" ry="4" class="card-outline ${t.data.main&&!a?"card-main-outline":""} ${a?"card-new-outline":""}" />\n    `}}function v({d:t,card_dim:e,x:a,y:r}){return{template:`\n      <g transform="translate(${a||e.w-20},${r||e.h-20})scale(.6)" style="cursor: pointer" class="card_edit pencil_icon">\n        <circle fill="rgba(0,0,0,0)" r="17" cx="8.5" cy="8.5" />\n        <path fill="currentColor" transform="translate(-1.5, -1.5)"\n           d="M19.082,2.123L17.749,0.79c-1.052-1.052-2.766-1.054-3.819,0L1.925,12.794c-0.06,0.06-0.104,0.135-0.127,0.216\n            l-1.778,6.224c-0.05,0.175-0.001,0.363,0.127,0.491c0.095,0.095,0.223,0.146,0.354,0.146c0.046,0,0.092-0.006,0.137-0.02\n            l6.224-1.778c0.082-0.023,0.156-0.066,0.216-0.127L19.082,5.942C20.134,4.89,20.134,3.176,19.082,2.123z M3.076,13.057l9.428-9.428\n            l3.738,3.739l-9.428,9.428L3.076,13.057z M2.566,13.961l3.345,3.344l-4.683,1.339L2.566,13.961z M18.375,5.235L16.95,6.66\n            l-3.738-3.739l1.425-1.425c0.664-0.663,1.741-0.664,2.405,0l1.333,1.333C19.038,3.493,19.038,4.572,18.375,5.235z"/>\n      </g>\n    `}}function b({d:t,card_dim:e}){return{template:`\n      <g transform="translate(${e.w-50},${e.h-20})scale(.035)" style="cursor: pointer" class="card_hide_rels hide_rels_icon">\n        <circle fill="rgba(0,0,0,0)" r="256" cx="256" cy="256" />\n        <g fill="currentColor">\n          <path d="m34,256l26.2,26.2c108,108 283.7,108 391.7,0l26.1-26.2-26.2-26.2c-108-108-283.7-108-391.7,0l-26.1,\n            26.2zm222,126.2c-75.8,0-151.6-28.9-209.3-86.6l-32.9-32.9c-3.7-3.7-3.7-9.7 0-13.5l32.9-32.9c115.4-115.4 303.2-115.4 418.6,\n            0l32.9,32.9c3.7,3.7 3.7,9.7 0,13.5l-32.9,32.9c-57.7,57.7-133.5,86.6-209.3,86.6z"/>\n          <path d="m256,183.5c-40,0-72.5,32.5-72.5,72.5s32.5,72.5 72.5,72.5c40,0 72.5-32.5 72.5-72.5s-32.5-72.5-72.5-72.5zm0,\n            164c-50.5,0-91.5-41.1-91.5-91.5 0-50.5 41.1-91.5 91.5-91.5s91.5,41.1 91.5,91.5c0,50.5-41,91.5-91.5,91.5z"/>\n        </g>\n      </g>\n    `}}function k({d:t,card_dim:e}){return{template:`\n      <g class="card_family_tree" style="cursor: pointer">\n        <rect x="-31" y="-25" width="72" height="15" fill="rgba(0,0,0,0)"></rect>\n        <g transform="translate(${.8*e.w},6)scale(.9)">\n          <rect x="-31" y="-25" width="72" height="15" fill="rgba(0,0,0,0)"></rect>\n          <line y2="-17.5" stroke="#fff" />\n          <line x1="-20" x2="20" y1="-17.5" y2="-17.5" stroke="#fff" />\n          <rect x="-31" y="-25" width="25" height="15" rx="5" ry="5" class="card-male" />\n          <rect x="6" y="-25" width="25" height="15" rx="5" ry="5" class="card-female" />\n        </g>\n      </g>\n    `}}function M({d:t,card_dim:e,x:a,y:r}){return{template:`\n      <g class="card_add_relative">\n        <g transform="translate(${a||e.w/2},${r||e.h})scale(.13)">\n          <circle r="80" cx="40" cy="40" fill="rgba(0,0,0,0)" />\n          <g transform="translate(-10, -8)">\n            <line\n              x1="10" x2="90" y1="50" y2="50"\n              stroke="currentColor" stroke-width="15" stroke-linecap="round"\n            />\n            <line\n              x1="50" x2="50" y1="10" y2="90"\n              stroke="currentColor" stroke-width="15" stroke-linecap="round"\n            />\n          </g>\n        </g>\n      </g>\n    `}}function E({x:t,y:e,rt:a,closed:r}){return{template:`\n      <g style="\n            transform: translate(-12.2px, -.5px);\n            cursor: pointer;\n          " \n          fill="currentColor" class="card_break_link${r?" closed":""}"\n        >\n        <g style="transform: translate(${t}px,${e}px)scale(.02)rotate(${a+"deg"})">\n          <rect width="1000" height="700" y="150" style="opacity: 0" />\n          <g class="link_upper">\n            <g>\n              <path d="M616.3,426.4c19,4.5,38.1-7.4,42.6-26.4c4.4-19-7.4-38-26.5-42.5L522.5,332c-18,11.1-53.9,33.4-53.9,33.4l80.4,18.6c-7.8,4.9-19.5,12.1-31.3,19.4L616.3,426.4L616.3,426.4z"/>\n              <path d="M727.4,244.2c-50.2-11.6-100.3,3.3-135.7,35.4c28.6,22.6,64.5,30.2,116.4,51.3l141,32.6c23.9,5.6,56.6,47.2,51.1,71l-4.1,17c-5.6,23.7-47.3,56.4-71.2,51l-143.4-33.2c-66.8-8.6-104.1-16.6-132.9-7.5c17.4,44.9,55.9,80.8,106.5,92.4L800.9,588c81.3,18.8,162.3-31.5,181.2-112.4l4-17c18.8-81.1-31.7-161.8-112.9-180.6L727.4,244.2z"/>\n            </g>\n          </g>\n          <g class="link_lower">\n            <path d="M421.2,384.9l-128,127.6c-13.9,13.8-13.9,36.2,0,50s36.3,13.8,50.2,0.1l136.2-135.8v-36.7l-58.4,58.1V384.9L421.2,384.9z"/>\n            <path d="M204.6,742.8c-17.4,17.3-63.3,17.2-80.6,0.1l-12.3-12.3c-17.3-17.3,0.6-81.2,17.9-98.5l100.2-99.9c12.5-14.9,45.8-40.8,66.1-103.7c-47.7-9.4-98.9,4.2-135.8,40.9L54.2,575c-58.9,58.8-58.9,154,0,212.8L66.6,800c58.9,58.8,154.5,58.8,213.4,0l105.8-105.6c38.4-38.3,51.3-91.9,39.7-141c-44,22.7-89,62.3-116,84.8L204.6,742.8z"/>\n          </g>\n          <g class="link_particles">\n            <path d="M351.9,248.4l-26.5,63.4l80.6,30.1L351.9,248.4z"/>\n            <path d="M529.3,208l-43,26.6l35.4,52.3L529.3,208z"/>\n            <path d="M426.6,158.8l-44-2.9l61.7,134.6L426.6,158.8z"/>\n          </g>\n        </g>\n      </g>\n    `}}function L({d:t,card_dim:e}){let a="",r=t.data.rels,n=t.data._rels||{},d=t.data.hide_rels,i=t=>t.father||t.mother,c=t=>t.children&&t.children.length>0;if((t.is_ancestry||t.data.main)&&(i(r)||i(n))&&(a+=E({x:e.w/2,y:0,rt:-45,closed:d}).template),!t.is_ancestry&&t.added){const i=t.spouse,s=i.data.rels,l=i.data._rels||{};(c(r)||c(n))&&(c(s)||c(l))&&(a+=E({x:t.sx-t.x+e.w/2+24.4,y:(t.x!==t.sx?e.h/2:e.h)+1,rt:135,closed:d}).template)}return a}function P({d:t,image:e,card_dim:a,maleIcon:r,femaleIcon:n}){return{template:`\n      <g style="transform: translate(${a.img_x}px,${a.img_y}px);" class="card_image" clip-path="url(#card_image_clip)">\n        ${e?`<image href="${e}" height="${a.img_h}" width="${a.img_w}" preserveAspectRatio="xMidYMin slice" />`:"F"===t.data.data.gender&&n?n({card_dim:a}):"M"===t.data.data.gender&&r?r({card_dim:a}):`\n        <g class="genderless-icon">\n          <rect height="${a.img_h}" width="${a.img_w}" fill="rgb(59, 85, 96)" />\n          <g transform="scale(${.001616*a.img_w})">\n           <path transform="translate(50,40)" fill="lightgrey" d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 \n              64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 \n              0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z" />\n          </g>\n        </g>\n      `}      \n      </g>\n    `}}function C(t,{store:e,data_stash:a,cont:r,datum:n,card_dim:d,cardEditForm:i,scale:c}){const s=r.getBoundingClientRect(),l=function(t){return{k:c||1,x:t.width/2,y:t.height/2}}(s);return{template:`\n        <svg id="family-tree-svg" style="width: 100%; height: 100%">\n          <rect width="${s.width}" height="${s.height}" fill="transparent" />\n          <g class="view">\n            <g transform="translate(${l.x}, ${l.y})scale(${l.k})">\n              ${t.data.slice(1).map(((t,e)=>function({d:t,is_vertical:e}){return{template:`\n        <path d="${function(){const{w:a,h:r}=d;let n=e&&t.y<0?{x:0,y:-r/2}:e&&t.y>0?{x:0,y:r/2}:!e&&t.x<0?{x:-a/2,y:0}:!e&&t.x>0?{x:a/2,y:0}:{x:0,y:0};if(e)return"M"+t.x+","+t.y+"C"+t.x+","+(t.y+(t.y<0?50:-50))+" "+n.x+","+(n.y+(t.y<0?-50:50))+" "+n.x+","+n.y;{const e=t.x>0?1:-1;return"M"+t.x+","+t.y+"C"+(n.x+50*e)+","+t.y+" "+(n.x+150*e)+","+n.y+" "+n.x+","+n.y}}()}" fill="none" stroke="#fff" />\n      `}}({d:t,is_vertical:!["spouse"].includes(t.data.rel_type)}).template))}\n              ${t.data.slice(1).map(((t,e)=>function({d:t,is_main:e}){const[a,r]=e?[160,60]:[160,40];return{template:`\n        <g transform="translate(${t.x}, ${t.y})" class="card" data-rel_type="${t.data.rel_type}" style="cursor: pointer">\n          <g transform="translate(${-a/2}, ${-r/2})">\n            ${function({d:t,w:e,h:a}){const r="M"===t.data.data.gender?"card-male":"F"===t.data.data.gender?"card-female":"card-genderless";return{template:`\n          <g>\n            <rect width="${e}" height="${a}" fill="#fff" rx="10" ${t.data.main?'stroke="#000"':""} class="${r}" />\n            <text transform="translate(0, ${a/4})">\n              <tspan x="10" dy="14">${t.data.data.label}</tspan>\n            </text>\n          </g>\n        `}}({d:t,w:a,h:r}).template}\n          </g>\n        </g>\n      `}}({d:t}).template))}\n            </g>\n          </g>\n        </svg>\n      `,mounted:t=>{var r;(r=t).addEventListener("click",(t=>{(function(t){if(!t.closest(".card"))return;const d=t.closest(".card").getAttribute("data-rel_type"),c=n,s=f({rel_datum:c,rel_type:d});return i({datum:s,rel_datum:c,rel_type:d,postSubmit:()=>{r.remove(),_({data_stash:a,datum:s}),m({datum:s,data_stash:a,rel_datum:c,rel_type:d}),e.update.tree()},store:e}),!0})(t.target)||r.remove()}))}}}function F(t,{card:e,d:a}){return d(t.getTree().data,!1),t.update.mainId(a.data.id),t.update.tree({tree_position:"inherit"}),!0}function z(t,{card:e,d:a,cardEditForm:r}){const n=a.data;r({datum:n,postSubmit:e=>{n.to_add&&c(n,t.getData()),e&&e.delete&&(n.main&&t.update.mainId(null),l(n,t.getData())),t.update.tree()},store:t})}function A(t,{card:e,d:a}){a.data.hide_rels=!a.data.hide_rels,n(a,a.data.hide_rels),t.update.tree({tree_position:"inherit"})}function I(t){const e=(t=function(t){const e={mini_tree:!0,link_break:!0,card_dim:{w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5}};t||(t={});for(const a in e)void 0===t[a]&&(t[a]=e[a]);return t}(t)).store;return function(){if(t.svg.querySelector("defs#f3CardDef"))return;const e=t.card_dim;function a(t,e,a){const{w:r,h:n}=t,d=e,i=a||[],c=t=>i.includes(t);return`${c("lx")?"M0,0":`M0,${d} Q 0,0 5,0`} ${c("rx")?`H${r}`:`H${r-d} Q ${r},0 ${r},5`} ${c("ry")?`V${n}`:`V${n-d} Q ${r},${n} ${r-d},${n}`} ${c("ly")?"H0":`H${d} Q 0,${n} 0,${n-d}`} z`}t.svg.insertAdjacentHTML("afterbegin",`\n        <defs id="f3CardDef">\n          <linearGradient id="fadeGrad">\n            <stop offset="0.9" stop-color="white" stop-opacity="0"/>\n            <stop offset=".91" stop-color="white" stop-opacity=".5"/>\n            <stop offset="1" stop-color="white" stop-opacity="1"/>\n          </linearGradient>\n          <mask id="fade" maskContentUnits="objectBoundingBox"><rect width="1" height="1" fill="url(#fadeGrad)"/></mask>\n          <clipPath id="card_clip"><path d="${a({w:e.w,h:e.h},5)}"></clipPath>\n          <clipPath id="card_text_clip"><rect width="${e.w-e.text_x-10}" height="${e.h-10}"></rect></clipPath>\n          <clipPath id="card_image_clip"><path d="M0,0 Q 0,0 0,0 H${e.img_w} V${e.img_h} H0 Q 0,${e.img_h} 0,${e.img_h} z"></clipPath>\n          <clipPath id="card_image_clip_curved"><path d="${a({w:e.img_w,h:e.img_h},5,["rx","ry"])}"></clipPath>\n        </defs>\n      `)}(),function({node:a,d:r}){const n=document.createElementNS("http://www.w3.org/2000/svg","g"),d="M"===r.data.data.gender?"card-male":"F"===r.data.data.gender?"card-female":"card-genderless",i=t.card_dim,c=!u(r,e.state.tree.data),s=t.cardEditForm?"ADD":"UNKNOWN";return n.innerHTML=`\n        <g class="card ${d}" data-id="${r.data.id}" data-cy="card">\n          <g transform="translate(${-i.w/2}, ${-i.h/2})">\n            ${t.mini_tree&&!r.data.to_add&&c?k({d:r,card_dim:i}).template:""}\n            ${w({d:r,card_dim:i,is_new:r.data.to_add}).template}\n            <g clip-path="url(#card_clip)">\n              ${r.data.to_add?$({d:r,card_dim:i,card_add:t.cardEditForm,label:s}).template:x({d:r,card_dim:i,card_display:t.card_display}).template}\n              ${r.data.to_add?"":P({d:r,image:r.data.data.avatar||null,card_dim:i,maleIcon:null,femaleIcon:null}).template}\n              ${!r.data.to_add&&t.cardEditForm?v({card_dim:i,x:i.w-46,y:i.h-20}).template:""}\n              ${!r.data.to_add&&t.cardEditForm?M({card_dim:i,x:i.w-26,y:i.h-20}).template:""}\n            </g>\n            ${t.link_break?L({d:r,card_dim:i}):""}\n          </g>\n        </g>\n      `,function(e,a,r){let n;n=e.querySelector(".card"),n&&n.addEventListener("click",(t=>{t.stopPropagation(),F(r,{card:e,d:a})})),n=e.querySelector(".card_edit"),n&&t.cardEditForm&&n.addEventListener("click",(n=>{n.stopPropagation(),z(r,{card:e,d:a,cardEditForm:t.cardEditForm})})),n=e.querySelector(".card_add"),n&&t.cardEditForm&&n.addEventListener("click",(n=>{n.stopPropagation(),z(r,{card:e,d:a,cardEditForm:t.cardEditForm})})),n=e.querySelector(".card_add_relative"),n&&n.addEventListener("click",(e=>{e.stopPropagation(),t.addRelative({d:a})})),n=e.querySelector(".card_family_tree"),n&&n.addEventListener("click",(t=>{t.stopPropagation(),F(r,{card:e,d:a})})),n=e.querySelector(".card_break_link"),n&&n.addEventListener("click",(t=>{t.stopPropagation(),A(r,{card:e,d:a})}))}(n,r,e),n}}var S=a(149);function T({store:t,cont:e,card_dim:a,cardEditForm:n,labels:i}){return function({d:c,scale:s}){!s&&window.innerWidth<650&&(s=window.innerWidth/650),d(t.getTree().data,!1),t.update.mainId(c.data.id),t.update.tree({tree_position:"main_to_middle",transition_time:1e3,scale:s}),function(t){const e=C(function({datum:t,data_stash:e,card_dim:a,labels:r}){const n=a.w+40,d=a.h+50,i=r||{};return{data:[{x:0,y:0,data:t=t||{id:"0",data:{fn:"FN",ln:"LN",gender:"M"}}},{x:-100,y:-d,data:{rel_type:"father",data:{label:i.father||"Add father",gender:"M"}}},{x:100,y:-d,data:{rel_type:"mother",data:{label:i.mother||"Add mother",gender:"F"}}},{x:n,y:0,data:{rel_type:"spouse",data:{label:i.spouse||"Add spouse",gender:"F"}}},{x:-100,y:d,data:{rel_type:"son",data:{label:i.son||"Add son",gender:"M"}}},{x:100,y:d,data:{rel_type:"daughter",data:{label:i.daughter||"Add daughter",gender:"F"}}}].filter((a=>{return"father"===(r=a.data.rel_type)?!t.rels.father||e.find((e=>e.id===t.rels.father)).to_add:"mother"!==r||!t.rels.mother||e.find((e=>e.id===t.rels.mother)).to_add;var r}))}}(t),t),a=document.createElement("div");a.style.cssText="width: 100%; height: 100%; position: absolute; top: 0; left: 0;background-color: rgba(0,0,0,.3);opacity: 0",a.innerHTML=e.template,t.cont.appendChild(a),e.mounted(a),r.select(a).transition().duration(t.transition_time).delay(t.transition_time/4).style("opacity",1)}({store:t,data_stash:t.getData(),cont:e,datum:c.data,transition_time:1e3,scale:s,card_dim:a,cardEditForm:n,labels:i})}}a.n(S)()})()})();